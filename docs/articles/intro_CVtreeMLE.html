<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CVtreeMLE">
<title>Evaluating Causal Effects of Mixed Exposures using Data Adaptive Decision Trees and CV-TMLE • CVtreeMLE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Evaluating Causal Effects of Mixed Exposures using Data Adaptive Decision Trees and CV-TMLE">
<meta property="og:description" content="CVtreeMLE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CVtreeMLE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro_CVtreeMLE.html">Evaluating Causal Effects of Mixed Exposures using Data Adaptive Decision Trees and CV-TMLE</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="intro_CVtreeMLE_files/kePrint-0.0.1/kePrint.js"></script><link href="intro_CVtreeMLE_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Evaluating Causal Effects of Mixed Exposures using Data Adaptive Decision Trees and CV-TMLE</h1>
                        <h4 data-toc-skip class="author"><a href="https://www.davidmccoy.org/" class="external-link">David McCoy</a></h4>
            
            <h4 data-toc-skip class="date">2024-03-26</h4>
      
      
      <div class="d-none name"><code>intro_CVtreeMLE.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Researchers are often interested in understanding what set of
thresholds in a mixed exposure are safest. That is, if a policy was to
be implemented to attempt to reduce an exposure or exposures below a set
limit, which intervention would have the largest minimizing effect.</p>
<p>The problem of course is that this set of thresholds is not known
beforehand. Therefore, it is necessary to both find the set of
thresholds that, controlling for other exposures and covariates, would
result in the lowest expected outcome.</p>
<p>This requires data-adaptive target parameters where cross-validation
is used. In one part of the data, we find the minimizing region and in
another, we estimate a policy intervention effect for that region.</p>
</div>
<div class="section level2">
<h2 id="data-adaptive-target-parameters">Data Adaptive Target Parameters<a class="anchor" aria-label="anchor" href="#data-adaptive-target-parameters"></a>
</h2>
<p>Data adaptive target parameters constitute a flexible framework for
estimating the effects of a data adaptively determined target parameter.
There is a literature on the dangers of deriving parameters
data-adaptively and the common approach for deriving consistent
inference for a data-adaptively defined parameter is to use
sample-splitting. In sample-splitting the researcher splits the full
data into a training set used to define the parameter, and an estimation
sample in which estimates are derived given the parameter identified in
training. Of course this approach can be costly when new samples are
collected for the estimation data or loses power when the full data is
simply split. Our proposed approach for a decision tree applied to
mixtures, aims to preserve the data-adaptive part of the sample
splitting algorithm but we define an average of the data-adaptive
parameter estimates across estimation samples based on arbitrary splits
in K-fold cross-validation. In this way, one can still use the power of
the entire dataset. The <code>CVtreeMLE</code> package implements
decision tree algorithms for computing thresholds in exposures that
maximize or minimize the outcome while flexibly adjusting for
covariates. The nodes in the decision tree are represented as a binary
exposures for which targeted minimum loss-based estimates (TMLE) are
derived for the counterfactual mean outcome difference if all individual
were exposed to the rule compared to the observed outcome under observed
exposure distribution. We call our estimate the ARE, the average
regional exposure effect.</p>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p>Two types of results are given for the region found to minimize or
maximize the expected outcome. K-fold specific results for a given ARE
and variance estimates for a fold specific region. The pooled ARE takes
the average across folds to gain power (reduce variance). The pooled ARE
estimates the oracle target parameter which is the region that maximizes
or minimizes the expected outcome. This of course can change across the
folds and therefore this estimate, if there is inconsistency in the
region estimated, can lead to an amalgamation of different regions.
However, if there is strong signal for a particular region, the same
exposures will be used in the region and therefore the pooled parameter
gains power, leveraging the k-fold specific estimates.</p>
<p>We give both so that researchers can look to see how consistent rules
are given sample splitting which adds information to the pooled
result.</p>
<p>For a technical presentation, the interested reader is invited to
consult <span class="citation">(<strong>mccoy2022CVtreeMLE?</strong>)</span> or the
earlier work of <span class="citation">van der Laan and Rose
(2011)</span>, <span class="citation">van der Laan and Rose
(2018)</span>, and <span class="citation">van der Laan et al.
(2022)</span>. For more background on data-adaptive target parameters
see <span class="citation">Hubbard, Kherad-Pajouh, and Van Der Laan
(2016)</span> and chapter 9 in <span class="citation">van der Laan and
Rose (2018)</span>.</p>
</div>
<div class="section level2">
<h2 id="mechanisms">Mechanisms<a class="anchor" aria-label="anchor" href="#mechanisms"></a>
</h2>
<p>Briefly, what this package will do is first, given the provided data
it will partition the data into folds based on the n_folds parameter
provided. In the training fold, we apply a custom decision tree that
greedily partitions the exposure space, at each partition it uses
g-computation to estimate the expected outcome for that region
controlling for covariates. It finds the region that maximizes or
minimizes the expected outcome. This is done for each fold. Then for
each region that maximizes or minimizes the expected outcome in each
fold, we estimate the effect comparing the expected outcome if everyone
was forced to be in that region compared to the observed outcome under
observed exposure. This is the ARE. This is done for each fold and we
also pool across the folds. This procedure is done with CV-TMLE. The
output are thresholds and the accompanying ARE for the region that has
the maximimum or minimum expected outcome.</p>
</div>
<div class="section level2">
<h2 id="working-example">Working Example<a class="anchor" aria-label="anchor" href="#working-example"></a>
</h2>
<p>To start, let’s load the packages we’ll need and set a seed for
simulation. We will use a real-world data example with known
ground-truth to show the functionality of <code>CVtreeMLE</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CVtreeMLE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tlverse.org/sl3" class="external-link">sl3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fl">5454433</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="nhanes-data">NHANES Data<a class="anchor" aria-label="anchor" href="#nhanes-data"></a>
</h2>
<p>Here we will try and replicate the analysis by Gibson et. al., <a href="https://ehjournal.biomedcentral.com/articles/10.1186/s12940-019-0515-1" class="external-link uri">https://ehjournal.biomedcentral.com/articles/10.1186/s12940-019-0515-1</a></p>
<p>and Mitro et. al, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4858394/" class="external-link uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4858394/</a></p>
<p>Who used the NHANES 2001-2002 data to investigate 18 POP exposures on
telomere length.</p>
<p>Because reduced telomere length is associated with more biological
aging and higher morbidity, we will try and identify which region in the
POP space would maximize telomere length. That is, we want to find the
region that, if we created a regulation on those chemicals, would result
in maximal change in elongating telomere length.</p>
<p>Let’s first load the data and investigate the variables:</p>
</div>
<div class="section level2">
<h2 id="nhanes-data-1">NHANES Data<a class="anchor" aria-label="anchor" href="#nhanes-data-1"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NHANES_eurocim"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">exposures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LBX074LA"</span>, <span class="co"># PCB74 Lipid Adj (ng/g)</span></span>
<span>               <span class="st">"LBX099LA"</span>, <span class="co"># PCB99 Lipid Adj (ng/g)</span></span>
<span>               <span class="st">"LBX118LA"</span>, <span class="co"># PCB118 Lipid Adj (ng/g)</span></span>
<span>               <span class="st">"LBX138LA"</span>, <span class="co"># PCB138 Lipid Adj (ng/g)</span></span>
<span>               <span class="st">"LBX153LA"</span>, <span class="co"># PCB153 Lipid Adj (ng/g)</span></span>
<span>               <span class="st">"LBX170LA"</span>, <span class="co"># PCB170 Lipid Adj (ng/g)</span></span>
<span>               <span class="st">"LBX180LA"</span>, <span class="co"># PCB180 Lipid Adj (ng/g)</span></span>
<span>               <span class="st">"LBX187LA"</span>, <span class="co"># PCB187 Lipid Adj (ng/g)</span></span>
<span>               <span class="st">"LBX194LA"</span>, <span class="co"># PCB194 Lipid Adj (ng/g)</span></span>
<span>               <span class="st">"LBXD03LA"</span>, <span class="co"># 1,2,3,6,7,8-hxcdd Lipid Adj (pg/g)</span></span>
<span>               <span class="st">"LBXD05LA"</span>, <span class="co"># 1,2,3,4,6,7,8-hpcdd Lipid Adj (pg/g)</span></span>
<span>               <span class="st">"LBXD07LA"</span>, <span class="co"># 1,2,3,4,6,7,8,9-ocdd Lipid Adj (pg/g)</span></span>
<span>               <span class="st">"LBXF03LA"</span>, <span class="co"># 2,3,4,7,8-pncdf Lipid Adj (pg/g)</span></span>
<span>               <span class="st">"LBXF04LA"</span>, <span class="co"># 1,2,3,4,7,8-hxcdf Lipid Adj (pg/g)</span></span>
<span>               <span class="st">"LBXF05LA"</span>, <span class="co"># 1,2,3,6,7,8-hxcdf Lipid Adj (pg/g)</span></span>
<span>               <span class="st">"LBXF08LA"</span>, <span class="co"># 1,2,3,4,6,7,8-hxcdf Lipid Adj (pg/g)</span></span>
<span>               <span class="st">"LBXHXCLA"</span>, <span class="co"># 3,3',4,4',5,5'-hxcb Lipid Adj (pg/g)</span></span>
<span>               <span class="st">"LBXPCBLA"</span><span class="op">)</span> <span class="co"># 3,3',4,4',5-pcnb Lipid Adj (pg/g)</span></span>
<span></span>
<span><span class="va">NHANES_eurocim</span> <span class="op">&lt;-</span> <span class="va">NHANES_eurocim</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">NHANES_eurocim</span><span class="op">[</span>, <span class="va">exposures</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="st">"TELOMEAN"</span></span>
<span></span>
<span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LBXWBCSI"</span>, <span class="co"># White blood cell count (SI)</span></span>
<span>                <span class="st">"LBXLYPCT"</span>, <span class="co"># Lymphocyte percent (%)</span></span>
<span>                <span class="st">"LBXMOPCT"</span>, <span class="co"># Monocyte percent (%)</span></span>
<span>                <span class="st">"LBXEOPCT"</span>, <span class="co"># Eosinophils percent (%)</span></span>
<span>                <span class="st">"LBXBAPCT"</span>, <span class="co"># Basophils percent (%)</span></span>
<span>                <span class="st">"LBXNEPCT"</span>, <span class="co"># Segmented neutrophils percent (%)</span></span>
<span>                <span class="st">"male"</span>, <span class="co"># Sex</span></span>
<span>                <span class="st">"age_cent"</span>, <span class="co"># Age at Screening, centered</span></span>
<span>                <span class="st">"race_cat"</span>, <span class="co"># race</span></span>
<span>                <span class="st">"bmi_cat3"</span>, <span class="co"># Body Mass Index (kg/m**2)</span></span>
<span>                <span class="st">"ln_lbxcot"</span>, <span class="co"># Cotinine (ng/mL), log-transformed</span></span>
<span>                <span class="st">"edu_cat"</span><span class="op">)</span> <span class="co"># Education Level - Adults 20+</span></span></code></pre></div>
<p>To improve consistency in the region we find to be the maximizing
region, it is best to remove an exposure of highly correlated sets, we
do that here:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the correlation matrix for the exposures</span></span>
<span><span class="va">cor_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">NHANES_eurocim</span><span class="op">[</span>, <span class="va">exposures</span><span class="op">]</span>, use <span class="op">=</span> <span class="st">"complete.obs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set a threshold for high correlation</span></span>
<span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span></span>
<span><span class="co"># Find pairs of highly correlated exposures</span></span>
<span><span class="va">highly_correlated_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cor_matrix</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">threshold</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="va">cor_matrix</span><span class="op">)</span>, arr.ind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initiate a vector to keep track of exposures to remove</span></span>
<span><span class="va">exposures_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through the highly correlated pairs and decide which exposure to remove</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">pair</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">highly_correlated_pairs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">row</span> <span class="op">&lt;-</span> <span class="va">highly_correlated_pairs</span><span class="op">[</span><span class="va">pair</span>, <span class="st">"row"</span><span class="op">]</span></span>
<span>  <span class="va">col</span> <span class="op">&lt;-</span> <span class="va">highly_correlated_pairs</span><span class="op">[</span><span class="va">pair</span>, <span class="st">"col"</span><span class="op">]</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cor_matrix</span><span class="op">)</span><span class="op">[</span><span class="va">row</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">exposures_to_remove</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">exposures_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">exposures_to_remove</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cor_matrix</span><span class="op">)</span><span class="op">[</span><span class="va">row</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Keep only uncorrelated exposures</span></span>
<span><span class="va">exposures_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">exposures</span>, <span class="va">exposures_to_remove</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-cvtreemle">Run CVtreeMLE<a class="anchor" aria-label="anchor" href="#run-cvtreemle"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhanes_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CVtreeMLE.html">CVtreeMLE</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">NHANES_eurocim</span>, <span class="co">## dataframe</span></span>
<span>  w <span class="op">=</span> <span class="va">covariates</span>,</span>
<span>  a <span class="op">=</span> <span class="va">exposures_to_keep</span>,</span>
<span>  y <span class="op">=</span> <span class="va">outcome</span>,</span>
<span>  n_folds <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">34421</span>,</span>
<span>  parallel_cv <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  num_cores <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  min_max <span class="op">=</span> <span class="st">"max"</span>, <span class="co"># we are going for the maximum</span></span>
<span>  min_obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">NHANES_eurocim</span><span class="op">)</span> <span class="op">*</span> <span class="fl">.1</span> <span class="co"># minimum number of individuals in a region to warrant split</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 85%. Estimated remaining time: 11 minutes, 0 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 100%. Estimated remaining time: 0 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 100%. Estimated remaining time: 0 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 100%. Estimated remaining time: 0 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 88%. Estimated remaining time: 1 minute, 17 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 41%. Estimated remaining time: 1 hour, 26 minutes, 19 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 84%. Estimated remaining time: 6 minutes, 12 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 75%. Estimated remaining time: 3 minutes, 10 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 100%. Estimated remaining time: 9 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 78%. Estimated remaining time: 17 minutes, 25 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 100%. Estimated remaining time: 0 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 100%. Estimated remaining time: 0 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 99%. Estimated remaining time: 36 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 85%. Estimated remaining time: 5 minutes, 45 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 90%. Estimated remaining time: 1 minute, 3 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 100%. Estimated remaining time: 9 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 100%. Estimated remaining time: 0 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 97%. Estimated remaining time: 1 minute, 10 seconds.</span></span>
<span><span class="co">#&gt; Growing trees.. Progress: 90%. Estimated remaining time: 1 minute, 3 seconds.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="investigating-results">Investigating Results<a class="anchor" aria-label="anchor" href="#investigating-results"></a>
</h2>
<p>Let’s first look at the results for each fold:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k_fold_results</span> <span class="op">&lt;-</span> <span class="va">nhanes_results</span><span class="op">$</span><span class="va">`V-Specific Mix Results`</span></span>
<span></span>
<span><span class="va">k_fold_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"K-fold Results"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_classic.html" class="external-link">kable_classic</a></span><span class="op">(</span>full_width <span class="op">=</span> <span class="cn">FALSE</span>, html_font <span class="op">=</span> <span class="st">"Cambria"</span><span class="op">)</span></span></code></pre></div>
<table class="table  lightable-classic" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
K-fold Results
</caption>
<thead><tr>
<th style="text-align:right;">
are
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
lower_ci
</th>
<th style="text-align:right;">
upper_ci
</th>
<th style="text-align:right;">
p_val
</th>
<th style="text-align:right;">
p_val_adj
</th>
<th style="text-align:right;">
rmse
</th>
<th style="text-align:left;">
mix_rule
</th>
<th style="text-align:right;">
fold
</th>
<th style="text-align:left;">
variables
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
-0.109
</td>
<td style="text-align:right;">
1.268
</td>
<td style="text-align:right;">
-2.593
</td>
<td style="text-align:right;">
2.375
</td>
<td style="text-align:right;">
0.931485
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.442
</td>
<td style="text-align:left;">
LBXD03LA &lt;= 12.9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
LBXD03LA
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.170
</td>
<td style="text-align:right;">
1.625
</td>
<td style="text-align:right;">
-3.354
</td>
<td style="text-align:right;">
3.015
</td>
<td style="text-align:right;">
0.916867
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.533
</td>
<td style="text-align:left;">
LBXD03LA &lt;= 13.2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
LBXD03LA
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.679
</td>
<td style="text-align:right;">
2.523
</td>
<td style="text-align:right;">
-5.624
</td>
<td style="text-align:right;">
4.266
</td>
<td style="text-align:right;">
0.787749
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.886
</td>
<td style="text-align:left;">
LBXD03LA &lt;= 13
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
LBXD03LA
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.485
</td>
<td style="text-align:right;">
1.917
</td>
<td style="text-align:right;">
-4.241
</td>
<td style="text-align:right;">
3.272
</td>
<td style="text-align:right;">
0.800305
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.672
</td>
<td style="text-align:left;">
LBXD03LA &lt;= 12.9
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
LBXD03LA
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.406
</td>
<td style="text-align:right;">
2.259
</td>
<td style="text-align:right;">
-4.834
</td>
<td style="text-align:right;">
4.022
</td>
<td style="text-align:right;">
0.857362
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.726
</td>
<td style="text-align:left;">
LBXD03LA &lt;= 13
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
LBXD03LA
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.122
</td>
<td style="text-align:right;">
1.379
</td>
<td style="text-align:right;">
-2.824
</td>
<td style="text-align:right;">
2.580
</td>
<td style="text-align:right;">
0.929303
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.463
</td>
<td style="text-align:left;">
LBXD03LA &lt;= 13
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
LBXD03LA
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.552
</td>
<td style="text-align:right;">
2.054
</td>
<td style="text-align:right;">
-4.578
</td>
<td style="text-align:right;">
3.474
</td>
<td style="text-align:right;">
0.788106
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.734
</td>
<td style="text-align:left;">
LBXD03LA &lt;= 13
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
LBXD03LA
</td>
</tr>
</tbody>
</table>
<p>This shows in all folds that LBXDO3LA was found to have the region
which maximizes telomere length if all individuals were forced to be
exposed to levels less than approximately 13. LBXDO3LA is
1,2,3,6,7,8-hxcdd Lipid Adj (pg/g) which is a Furan.</p>
<p>The pooled result is interpretable because it will be the average of
estimates in the regions for the same variable:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pooled_mixture_results</span> <span class="op">&lt;-</span> <span class="va">nhanes_results</span><span class="op">$</span><span class="va">`Oracle Region Results`</span></span>
<span></span>
<span><span class="va">pooled_mixture_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Oracle Mixture Results"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_classic.html" class="external-link">kable_classic</a></span><span class="op">(</span>full_width <span class="op">=</span> <span class="cn">FALSE</span>, html_font <span class="op">=</span> <span class="st">"Cambria"</span><span class="op">)</span></span></code></pre></div>
<table class="table  lightable-classic" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Oracle Mixture Results
</caption>
<thead><tr>
<th style="text-align:right;">
Region ARE
</th>
<th style="text-align:right;">
Standard Error
</th>
<th style="text-align:right;">
Lower CI
</th>
<th style="text-align:right;">
Upper CI
</th>
<th style="text-align:right;">
P-value
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
-0.563
</td>
<td style="text-align:right;">
1.062
</td>
<td style="text-align:right;">
-2.644
</td>
<td style="text-align:right;">
1.518
</td>
<td style="text-align:right;">
0.595802
</td>
</tr></tbody>
</table>
<p>We can also examine the pooled estimates by exposure set with average
rules in each set:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">region_specific_pooling</span> <span class="op">&lt;-</span> <span class="va">nhanes_results</span><span class="op">$</span><span class="va">`Pooled TMLE Mixture Results`</span></span>
<span></span>
<span><span class="va">region_specific_pooling</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Region Specific Mixture Results"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_classic.html" class="external-link">kable_classic</a></span><span class="op">(</span>full_width <span class="op">=</span> <span class="cn">FALSE</span>, html_font <span class="op">=</span> <span class="st">"Cambria"</span><span class="op">)</span></span></code></pre></div>
<table class="table  lightable-classic" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Region Specific Mixture Results
</caption>
<thead><tr>
<th style="text-align:right;">
Mixture ATE
</th>
<th style="text-align:right;">
Standard Error
</th>
<th style="text-align:right;">
Lower CI
</th>
<th style="text-align:right;">
Upper CI
</th>
<th style="text-align:right;">
P-value
</th>
<th style="text-align:right;">
P-value Adj
</th>
<th style="text-align:left;">
Vars
</th>
<th style="text-align:right;">
RMSE
</th>
<th style="text-align:left;">
Average_Rule
</th>
<th style="text-align:right;">
Proportion_Folds
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
-0.563
</td>
<td style="text-align:right;">
1.062
</td>
<td style="text-align:right;">
-2.644
</td>
<td style="text-align:right;">
1.518
</td>
<td style="text-align:right;">
0.595802
</td>
<td style="text-align:right;">
0.595802
</td>
<td style="text-align:left;">
LBXD03LA
</td>
<td style="text-align:right;">
0.918
</td>
<td style="text-align:left;">
LBXD03LA &lt;=13(12.9,13.2)
</td>
<td style="text-align:right;">
1
</td>
</tr></tbody>
</table>
</div>
<div class="section level2">
<h2 id="estimate-stability">Estimate Stability<a class="anchor" aria-label="anchor" href="#estimate-stability"></a>
</h2>
<p>Because we are identifying thresholds mixture space data-adaptively
using the training data as we rotate through the folds,
<code>CVtreeMLE</code> will give, in the event that a signal actually
exists, more consistent results when higher n_fold values are used.
Thus, we recommend using 10-fold CV when possible for more consistent
and interpretable results.</p>
</div>
<div class="section level2">
<h2 id="runtime-performance-guidelines">Runtime Performance Guidelines<a class="anchor" aria-label="anchor" href="#runtime-performance-guidelines"></a>
</h2>
<p><code>CVtreeMLE</code> uses ensemble machine learning which is
obviously computationally demanding. The <code>utils_create_sls.R</code>
function creates some lean yet non-parametric ensemble learners for each
parameter. For example, glm, elastic net, random forest, and xgboost
models are created for the nuisance parameters and decision trees of
various depths are created for the decision tree fitting Super Learner.
Users are also welcome to pass their own stacks of learners in to
<code>CVtreeMLE</code> if they feel the default estimators are
insufficient given the complexity of the data. Additionally, to help
with computational time, <code>CVtreeMLE</code> uses the future package
for sequential and parallel processing. The default functionality is to
parallelize across the folds (parallel_cv = TRUE). The default
parallelization type is multi-session, this is because we expect most
users to be programming in Rstudio where multicore is not supported.
Thus, a user should expected multiple cores to be in use, the number
which is equal to num_cores with high CPU usage on each core because the
data and models are copied to each core. This is different from
multicore where the data is not copied. As we saw above, in this
example, a dataset with 500 observations and 7 exposures took about 5
minutes with 5 folds. Thus, when using 10-fold CV, which we recommend,
on a standard environmental epidemiology data set of 500- 1000
observations, <code>CVtreeMLE</code> should run easily on a modern local
machine.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Hubbard2016" class="csl-entry">
Hubbard, Alan E., Sara Kherad-Pajouh, and Mark J. Van Der Laan. 2016.
<span>“<span class="nocase">Statistical Inference for Data Adaptive
Target Parameters</span>.”</span> <em>International Journal of
Biostatistics</em> 12 (1): 3–19. <a href="https://doi.org/10.1515/ijb-2015-0013" class="external-link">https://doi.org/10.1515/ijb-2015-0013</a>.
</div>
<div id="ref-vdl2022targeted" class="csl-entry">
van der Laan, Mark J, Jeremy R Coyle, Nima S Hejazi, Ivana Malenica,
Rachael V Phillips, and Alan E Hubbard. 2022. <em><span class="nocase">Targeted Learning in <code>R</code>: A Causal Data
Science Handbook</span></em>. CRC Press. <a href="https://tlverse.org/tlverse-handbook/" class="external-link">https://tlverse.org/tlverse-handbook/</a>.
</div>
<div id="ref-vdl2011targeted" class="csl-entry">
van der Laan, Mark J, and Sherri Rose. 2011. <em>Targeted Learning:
Causal Inference for Observational and Experimental Data</em>. Springer
Science &amp; Business Media.
</div>
<div id="ref-vdl2018targeted" class="csl-entry">
———. 2018. <em>Targeted Learning in Data Science: Causal Inference for
Complex Longitudinal Studies</em>. Springer Science &amp; Business
Media.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David McCoy.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
