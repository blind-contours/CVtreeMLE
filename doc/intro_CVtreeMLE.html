<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="David McCoy" />

<meta name="date" content="2024-06-17" />

<title>Evaluating Causal Effects of Mixed Exposures using Data Adaptive Decision Trees and CV-TMLE</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>$(document).ready(function(){
    if (typeof $('[data-toggle="tooltip"]').tooltip === 'function') {
        $('[data-toggle="tooltip"]').tooltip();
    }
    if ($('[data-toggle="popover"]').popover === 'function') {
        $('[data-toggle="popover"]').popover();
    }
});
</script>
<style type="text/css">
.lightable-minimal {
border-collapse: separate;
border-spacing: 16px 1px;
width: 100%;
margin-bottom: 10px;
}
.lightable-minimal td {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal th {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal thead tr:last-child th {
border-bottom: 2px solid #00000050;
empty-cells: hide;
}
.lightable-minimal tbody tr:first-child td {
padding-top: 0.5em;
}
.lightable-minimal.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-minimal.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic {
border-top: 0.16em solid #111111;
border-bottom: 0.16em solid #111111;
width: 100%;
margin-bottom: 10px;
margin: 10px 5px;
}
.lightable-classic tfoot tr td {
border: 0;
}
.lightable-classic tfoot tr:first-child td {
border-top: 0.14em solid #111111;
}
.lightable-classic caption {
color: #222222;
}
.lightable-classic td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic thead tr:last-child th {
border-bottom: 0.10em solid #111111;
}
.lightable-classic.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic-2 {
border-top: 3px double #111111;
border-bottom: 3px double #111111;
width: 100%;
margin-bottom: 10px;
}
.lightable-classic-2 tfoot tr td {
border: 0;
}
.lightable-classic-2 tfoot tr:first-child td {
border-top: 3px double #111111;
}
.lightable-classic-2 caption {
color: #222222;
}
.lightable-classic-2 td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic-2 th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic-2 tbody tr:last-child td {
border-bottom: 3px double #111111;
}
.lightable-classic-2 thead tr:last-child th {
border-bottom: 1px solid #111111;
}
.lightable-classic-2.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic-2.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #EEE;
border-collapse: collapse;
margin-bottom: 10px;
}
.lightable-material tfoot tr td {
border: 0;
}
.lightable-material tfoot tr:first-child td {
border-top: 1px solid #EEE;
}
.lightable-material th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
}
.lightable-material td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
border-top: 1px solid #eeeeee;
}
.lightable-material.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody td {
border: 0;
}
.lightable-material.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #ddd;
}
.lightable-material-dark {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #FFFFFF12;
border-collapse: collapse;
margin-bottom: 10px;
background-color: #363640;
}
.lightable-material-dark tfoot tr td {
border: 0;
}
.lightable-material-dark tfoot tr:first-child td {
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF60;
}
.lightable-material-dark td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF;
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark.lightable-hover tbody tr:hover {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody tr:nth-child(even) {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody td {
border: 0;
}
.lightable-material-dark.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #FFFFFF12;
}
.lightable-paper {
width: 100%;
margin-bottom: 10px;
color: #444;
}
.lightable-paper tfoot tr td {
border: 0;
}
.lightable-paper tfoot tr:first-child td {
border-top: 1px solid #00000020;
}
.lightable-paper thead tr:last-child th {
color: #666;
vertical-align: bottom;
border-bottom: 1px solid #00000020;
line-height: 1.15em;
padding: 10px 5px;
}
.lightable-paper td {
vertical-align: middle;
border-bottom: 1px solid #00000010;
line-height: 1.15em;
padding: 7px 5px;
}
.lightable-paper.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-paper.lightable-striped tbody tr:nth-child(even) {
background-color: #00000008;
}
.lightable-paper.lightable-striped tbody td {
border: 0;
}
</style>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Evaluating Causal Effects of Mixed
Exposures using Data Adaptive Decision Trees and CV-TMLE</h1>
<h4 class="author"><a href="https://www.davidmccoy.org/">David
McCoy</a></h4>
<h4 class="date">2024-06-17</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Researchers are often interested in understanding what set of
thresholds in a mixed exposure are safest. That is, if a policy was to
be implemented to attempt to reduce an exposure or exposures below a set
limit, which intervention would have the largest minimizing effect.</p>
<p>The problem of course is that this set of thresholds is not known
beforehand. Therefore, it is necessary to both find the set of
thresholds that, controlling for other exposures and covariates, would
result in the lowest expected outcome.</p>
<p>This requires data-adaptive target parameters where cross-validation
is used. In one part of the data, we find the minimizing region and in
another, we estimate a policy intervention effect for that region.</p>
</div>
<div id="data-adaptive-target-parameters" class="section level2">
<h2>Data Adaptive Target Parameters</h2>
<p>Data adaptive target parameters constitute a flexible framework for
estimating the effects of a data adaptively determined target parameter.
There is a literature on the dangers of deriving parameters
data-adaptively and the common approach for deriving consistent
inference for a data-adaptively defined parameter is to use
sample-splitting. In sample-splitting the researcher splits the full
data into a training set used to define the parameter, and an estimation
sample in which estimates are derived given the parameter identified in
training. Of course this approach can be costly when new samples are
collected for the estimation data or loses power when the full data is
simply split. Our proposed approach for a decision tree applied to
mixtures, aims to preserve the data-adaptive part of the sample
splitting algorithm but we define an average of the data-adaptive
parameter estimates across estimation samples based on arbitrary splits
in K-fold cross-validation. In this way, one can still use the power of
the entire dataset. The <code>CVtreeMLE</code> package implements
decision tree algorithms for computing thresholds in exposures that
maximize or minimize the outcome while flexibly adjusting for
covariates. The nodes in the decision tree are represented as a binary
exposures for which targeted minimum loss-based estimates (TMLE) are
derived for the counterfactual mean outcome difference if all individual
were exposed to the rule compared to the observed outcome under observed
exposure distribution. We call our estimate the ARE, the average
regional exposure effect.</p>
</div>
<div id="output" class="section level2">
<h2>Output</h2>
<p>Two types of results are given for the region found to minimize or
maximize the expected outcome. K-fold specific results for a given ARE
and variance estimates for a fold specific region. The pooled ARE takes
the average across folds to gain power (reduce variance). The pooled ARE
estimates the oracle target parameter which is the region that maximizes
or minimizes the expected outcome. This of course can change across the
folds and therefore this estimate, if there is inconsistency in the
region estimated, can lead to an amalgamation of different regions.
However, if there is strong signal for a particular region, the same
exposures will be used in the region and therefore the pooled parameter
gains power, leveraging the k-fold specific estimates.</p>
<p>We give both so that researchers can look to see how consistent rules
are given sample splitting which adds information to the pooled
result.</p>
<p>For a technical presentation, the interested reader is invited to
consult <span class="citation">(<strong>mccoy2022CVtreeMLE?</strong>)</span> or the
earlier work of <span class="citation">van der Laan and Rose
(2011)</span>, <span class="citation">van der Laan and Rose
(2018)</span>, and <span class="citation">van der Laan et al.
(2022)</span>. For more background on data-adaptive target parameters
see <span class="citation">Hubbard, Kherad-Pajouh, and Van Der Laan
(2016)</span> and chapter 9 in <span class="citation">van der Laan and
Rose (2018)</span>.</p>
</div>
<div id="mechanisms" class="section level2">
<h2>Mechanisms</h2>
<p>Briefly, what this package will do is first, given the provided data
it will partition the data into folds based on the n_folds parameter
provided. In the training fold, we apply a custom decision tree that
greedily partitions the exposure space, at each partition it uses
g-computation to estimate the expected outcome for that region
controlling for covariates. It finds the region that maximizes or
minimizes the expected outcome. This is done for each fold. Then for
each region that maximizes or minimizes the expected outcome in each
fold, we estimate the effect comparing the expected outcome if everyone
was forced to be in that region compared to the observed outcome under
observed exposure. This is the ARE. This is done for each fold and we
also pool across the folds. This procedure is done with CV-TMLE. The
output are thresholds and the accompanying ARE for the region that has
the maximimum or minimum expected outcome.</p>
</div>
<div id="working-example" class="section level2">
<h2>Working Example</h2>
<p>To start, let’s load the packages we’ll need and set a seed for
simulation. We will use a real-world data example with known
ground-truth to show the functionality of <code>CVtreeMLE</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(CVtreeMLE)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(sl3)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>seed <span class="ot">&lt;-</span> <span class="dv">5454433</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">set.seed</span>(seed)</span></code></pre></div>
</div>
<div id="nhanes-data" class="section level2">
<h2>NHANES Data</h2>
<p>Here we will try and replicate the analysis by Gibson et. al., <a href="https://ehjournal.biomedcentral.com/articles/10.1186/s12940-019-0515-1" class="uri">https://ehjournal.biomedcentral.com/articles/10.1186/s12940-019-0515-1</a></p>
<p>and Mitro et. al, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4858394/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4858394/</a></p>
<p>Who used the NHANES 2001-2002 data to investigate 18 POP exposures on
telomere length.</p>
<p>Because reduced telomere length is associated with more biological
aging and higher morbidity, we will try and identify which region in the
POP space would maximize telomere length. That is, we want to find the
region that, if we created a regulation on those chemicals, would result
in maximal change in elongating telomere length.</p>
<p>Let’s first load the data and investigate the variables:</p>
</div>
<div id="nhanes-data-1" class="section level2">
<h2>NHANES Data</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;NHANES_eurocim&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>exposures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;LBX074LA&quot;</span>, <span class="co"># PCB74 Lipid Adj (ng/g)</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>               <span class="st">&quot;LBX099LA&quot;</span>, <span class="co"># PCB99 Lipid Adj (ng/g)</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>               <span class="st">&quot;LBX118LA&quot;</span>, <span class="co"># PCB118 Lipid Adj (ng/g)</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>               <span class="st">&quot;LBX138LA&quot;</span>, <span class="co"># PCB138 Lipid Adj (ng/g)</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>               <span class="st">&quot;LBX153LA&quot;</span>, <span class="co"># PCB153 Lipid Adj (ng/g)</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>               <span class="st">&quot;LBX170LA&quot;</span>, <span class="co"># PCB170 Lipid Adj (ng/g)</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>               <span class="st">&quot;LBX180LA&quot;</span>, <span class="co"># PCB180 Lipid Adj (ng/g)</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>               <span class="st">&quot;LBX187LA&quot;</span>, <span class="co"># PCB187 Lipid Adj (ng/g)</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>               <span class="st">&quot;LBX194LA&quot;</span>, <span class="co"># PCB194 Lipid Adj (ng/g)</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>               <span class="st">&quot;LBXD03LA&quot;</span>, <span class="co"># 1,2,3,6,7,8-hxcdd Lipid Adj (pg/g)</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>               <span class="st">&quot;LBXD05LA&quot;</span>, <span class="co"># 1,2,3,4,6,7,8-hpcdd Lipid Adj (pg/g)</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>               <span class="st">&quot;LBXD07LA&quot;</span>, <span class="co"># 1,2,3,4,6,7,8,9-ocdd Lipid Adj (pg/g)</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>               <span class="st">&quot;LBXF03LA&quot;</span>, <span class="co"># 2,3,4,7,8-pncdf Lipid Adj (pg/g)</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>               <span class="st">&quot;LBXF04LA&quot;</span>, <span class="co"># 1,2,3,4,7,8-hxcdf Lipid Adj (pg/g)</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>               <span class="st">&quot;LBXF05LA&quot;</span>, <span class="co"># 1,2,3,6,7,8-hxcdf Lipid Adj (pg/g)</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>               <span class="st">&quot;LBXF08LA&quot;</span>, <span class="co"># 1,2,3,4,6,7,8-hxcdf Lipid Adj (pg/g)</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>               <span class="st">&quot;LBXHXCLA&quot;</span>, <span class="co"># 3,3&#39;,4,4&#39;,5,5&#39;-hxcb Lipid Adj (pg/g)</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>               <span class="st">&quot;LBXPCBLA&quot;</span>) <span class="co"># 3,3&#39;,4,4&#39;,5-pcnb Lipid Adj (pg/g)</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>NHANES_eurocim <span class="ot">&lt;-</span> NHANES_eurocim[<span class="fu">complete.cases</span>(NHANES_eurocim[, exposures]), ]</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>outcome <span class="ot">&lt;-</span> <span class="st">&quot;TELOMEAN&quot;</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>covariates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;LBXWBCSI&quot;</span>, <span class="co"># White blood cell count (SI)</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>                <span class="st">&quot;LBXLYPCT&quot;</span>, <span class="co"># Lymphocyte percent (%)</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>                <span class="st">&quot;LBXMOPCT&quot;</span>, <span class="co"># Monocyte percent (%)</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>                <span class="st">&quot;LBXEOPCT&quot;</span>, <span class="co"># Eosinophils percent (%)</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>                <span class="st">&quot;LBXBAPCT&quot;</span>, <span class="co"># Basophils percent (%)</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>                <span class="st">&quot;LBXNEPCT&quot;</span>, <span class="co"># Segmented neutrophils percent (%)</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>                <span class="st">&quot;male&quot;</span>, <span class="co"># Sex</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>                <span class="st">&quot;age_cent&quot;</span>, <span class="co"># Age at Screening, centered</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>                <span class="st">&quot;race_cat&quot;</span>, <span class="co"># race</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>                <span class="st">&quot;bmi_cat3&quot;</span>, <span class="co"># Body Mass Index (kg/m**2)</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>                <span class="st">&quot;ln_lbxcot&quot;</span>, <span class="co"># Cotinine (ng/mL), log-transformed</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a>                <span class="st">&quot;edu_cat&quot;</span>) <span class="co"># Education Level - Adults 20+</span></span></code></pre></div>
<p>To improve consistency in the region we find to be the maximizing
region, it is best to remove an exposure of highly correlated sets, we
do that here:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Calculate the correlation matrix for the exposures</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(NHANES_eurocim[, exposures], <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Set a threshold for high correlation</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># Find pairs of highly correlated exposures</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>highly_correlated_pairs <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(cor_matrix) <span class="sc">&gt;</span> threshold <span class="sc">&amp;</span> <span class="fu">lower.tri</span>(cor_matrix), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co"># Initiate a vector to keep track of exposures to remove</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>exposures_to_remove <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co"># Loop through the highly correlated pairs and decide which exposure to remove</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="cf">for</span> (pair <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(highly_correlated_pairs))) {</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  row <span class="ot">&lt;-</span> highly_correlated_pairs[pair, <span class="st">&quot;row&quot;</span>]</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  col <span class="ot">&lt;-</span> highly_correlated_pairs[pair, <span class="st">&quot;col&quot;</span>]</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">colnames</span>(cor_matrix)[row] <span class="sc">%in%</span> exposures_to_remove)) {</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>    exposures_to_remove <span class="ot">&lt;-</span> <span class="fu">c</span>(exposures_to_remove, <span class="fu">colnames</span>(cor_matrix)[row])</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  }</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>}</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co"># Keep only uncorrelated exposures</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>exposures_to_keep <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(exposures, exposures_to_remove)</span></code></pre></div>
</div>
<div id="run-cvtreemle" class="section level2">
<h2>Run CVtreeMLE</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># Convert continuous X variables to their corresponding deciles</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>NHANES_eurocim[, exposures_to_keep] <span class="ot">&lt;-</span> <span class="fu">apply</span>(NHANES_eurocim[, exposures_to_keep], <span class="dv">2</span>, round, <span class="dv">1</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>nhanes_results <span class="ot">&lt;-</span> <span class="fu">CVtreeMLE</span>(</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="at">data =</span> NHANES_eurocim, <span class="do">## dataframe</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="at">w =</span> covariates,</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  <span class="at">a =</span> exposures_to_keep,</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="at">y =</span> outcome,</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">5</span>,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">34421</span>,</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>  <span class="at">parallel_cv =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  <span class="at">parallel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">&quot;continuous&quot;</span>,</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  <span class="at">num_cores =</span> <span class="dv">8</span>,</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  <span class="at">min_max =</span> <span class="st">&quot;max&quot;</span>,</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>  <span class="at">min_obs =</span> <span class="dv">20</span>,</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>  <span class="at">p_val_thresh =</span> <span class="dv">1</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="investigating-results" class="section level2">
<h2>Investigating Results</h2>
<p>Let’s first look at the results for each fold:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>k_fold_results <span class="ot">&lt;-</span> nhanes_results<span class="sc">$</span><span class="st">`</span><span class="at">V-Specific Mix Results</span><span class="st">`</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>k_fold_results <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;K-fold Results&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_classic</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">html_font =</span> <span class="st">&quot;Cambria&quot;</span>)</span></code></pre></div>
<table class=" lightable-classic" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
K-fold Results
</caption>
<tbody>
<tr>
</tr>
</tbody>
</table>
<p>The pooled result is interpretable because it will be the average of
estimates in the regions for the same variable:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>pooled_mixture_results <span class="ot">&lt;-</span> nhanes_results<span class="sc">$</span><span class="st">`</span><span class="at">Oracle Region Results</span><span class="st">`</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>pooled_mixture_results <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Oracle Mixture Results&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_classic</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">html_font =</span> <span class="st">&quot;Cambria&quot;</span>)</span></code></pre></div>
<table class=" lightable-classic" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Oracle Mixture Results
</caption>
<tbody>
<tr>
</tr>
</tbody>
</table>
<p>We can also examine the pooled estimates by exposure set with average
rules in each set:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>region_specific_pooling <span class="ot">&lt;-</span> nhanes_results<span class="sc">$</span><span class="st">`</span><span class="at">Pooled TMLE Mixture Results</span><span class="st">`</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>region_specific_pooling <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Region Specific Mixture Results&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_classic</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">html_font =</span> <span class="st">&quot;Cambria&quot;</span>)</span></code></pre></div>
<table class=" lightable-classic" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Region Specific Mixture Results
</caption>
<tbody>
<tr>
</tr>
</tbody>
</table>
</div>
<div id="estimate-stability" class="section level2">
<h2>Estimate Stability</h2>
<p>Because we are identifying thresholds mixture space data-adaptively
using the training data as we rotate through the folds,
<code>CVtreeMLE</code> will give, in the event that a signal actually
exists, more consistent results when higher n_fold values are used.
Thus, we recommend using 10-fold CV when possible for more consistent
and interpretable results.</p>
</div>
<div id="runtime-performance-guidelines" class="section level2">
<h2>Runtime Performance Guidelines</h2>
<p><code>CVtreeMLE</code> uses ensemble machine learning which is
obviously computationally demanding. The <code>utils_create_sls.R</code>
function creates some lean yet non-parametric ensemble learners for each
parameter. For example, glm, elastic net, random forest, and xgboost
models are created for the nuisance parameters and decision trees of
various depths are created for the decision tree fitting Super Learner.
Users are also welcome to pass their own stacks of learners in to
<code>CVtreeMLE</code> if they feel the default estimators are
insufficient given the complexity of the data. Additionally, to help
with computational time, <code>CVtreeMLE</code> uses the future package
for sequential and parallel processing. The default functionality is to
parallelize across the folds (parallel_cv = TRUE). The default
parallelization type is multi-session, this is because we expect most
users to be programming in Rstudio where multicore is not supported.
Thus, a user should expected multiple cores to be in use, the number
which is equal to num_cores with high CPU usage on each core because the
data and models are copied to each core. This is different from
multicore where the data is not copied. As we saw above, in this
example, a dataset with 500 observations and 7 exposures took about 5
minutes with 5 folds. Thus, when using 10-fold CV, which we recommend,
on a standard environmental epidemiology data set of 500- 1000
observations, <code>CVtreeMLE</code> should run easily on a modern local
machine.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Hubbard2016" class="csl-entry">
Hubbard, Alan E., Sara Kherad-Pajouh, and Mark J. Van Der Laan. 2016.
<span>“<span class="nocase">Statistical Inference for Data Adaptive
Target Parameters</span>.”</span> <em>International Journal of
Biostatistics</em> 12 (1): 3–19. <a href="https://doi.org/10.1515/ijb-2015-0013">https://doi.org/10.1515/ijb-2015-0013</a>.
</div>
<div id="ref-vdl2022targeted" class="csl-entry">
van der Laan, Mark J, Jeremy R Coyle, Nima S Hejazi, Ivana Malenica,
Rachael V Phillips, and Alan E Hubbard. 2022. <em><span class="nocase">Targeted Learning in <code>R</code>: A Causal Data
Science Handbook</span></em>. CRC Press. <a href="https://tlverse.org/tlverse-handbook/">https://tlverse.org/tlverse-handbook/</a>.
</div>
<div id="ref-vdl2011targeted" class="csl-entry">
van der Laan, Mark J, and Sherri Rose. 2011. <em>Targeted Learning:
Causal Inference for Observational and Experimental Data</em>. Springer
Science &amp; Business Media.
</div>
<div id="ref-vdl2018targeted" class="csl-entry">
———. 2018. <em>Targeted Learning in Data Science: Causal Inference for
Complex Longitudinal Studies</em>. Springer Science &amp; Business
Media.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
